name: Check links of the site
on:
  # TODO schedule and workflow_dispatch in the final implementation
  pull_request:
    branches:
      - master

jobs:
  check_links:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4 # access to the local action
      - name: Build Setup
        uses: ./.github/actions/build-setup
        ## TODO duplicated with the build-pr-site action
        # only require if we build o part of the documentation
      - name: Install antora dependencies for xref validation
        run: npm install --save-dev antora@3.2.0-alpha.2
      - name: Build site
        run: |
          ./build-preview-dev.bash --hide-edit-page-links true --force-production-navbar true --type links-check --component bonita --branch 2023.1
      - name: Install htmltest
        run: |
          echo "Installing htmltest"
          curl https://htmltest.wjdp.uk | bash -s -- -b scripts/htmltest v0.17.0
          echo "Installation done"
          ./scripts/htmltest/htmltest --version
          pwd
          ls -lh
          ls -lh ./scripts/htmltest
      - name: Check links
        working-directory: scripts/htmltest
        run: |
          ./htmltest -c ./htmltest_bonita-documentation-site.yml ../../build/site
          ls -lh config/
# TODO upload log artifact

